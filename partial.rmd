---
title: "Analysis by County"
author: ""
date: "4/27/2018"
output: html_document:
    code_folding: hide
---

```{r}
library(fivethirtyeight)
library(tidyverse)
library(dplyr)
library(mosaic)
View(police_killings)
```


# Analysis by County
Kendra and Yifan, something like this! Where every row is a county. Use this data for your analysis. 

Maybe add some more vairbales now that you see how it works. 

```{r}
county_data <- police_killings %>%
  mutate(g = ifelse(gender == "Male", 1, 0),
         w = ifelse(raceethnicity == "White", 1,0)) %>%
  group_by(county_id) %>%
  summarise(n_deaths = n(),
            tot_pop = sum(pop, na.rm=TRUE), 
            n_male = sum(g),
            n_white = sum(w, na.rm=TRUE),
            avg_pov = mean(pov, na.rm=TRUE),
            avg_urate = mean(urate, na.rm=TRUE),
            avg_college = mean(college, na.rm=TRUE)) %>%
  mutate(percent_m = n_male/n_deaths, 
         prop_n_deaths = n_deaths/tot_pop*1000,
         percent_white = n_white/n_deaths)
county_data
```

```{r}
ggplot(county_data, aes(x = prop_n_deaths)) +
  geom_histogram()
```

Then you can fit some linear models, like this

```{r}
a_model_for_you <- lm(prop_n_deaths ~ n_male +  percent_white + avg_pov + avg_urate + avg_college, data = county_data)

summary(a_model_for_you)
```

diagnostics

```{r}
plot(a_model_for_you)
```

Make some bivariate scatterplots here. 

```{r}
#ggplot(county_data, aes(x = n_male, y = prop_n_deaths))+
 #        geom_point(position = "identity")
```

```{r}
ggplot(county_data, aes(x = n_white, y = prop_n_deaths))+
         geom_scatter(stat = "identity")
```

### Which county are the outliers

```{r}
outliers <- county_data %>%
  left_join(police_killings, by = "county_id") %>%
  select(county_id:percent_white, city, state)%>%
  mutate (o = percent_white/prop_n_deaths) %>%
  arrange (desc(o))%>%
  head(10)
```

### Comparison of race distribution of victims 

```{r}
county_data <- county_data %>%
  mutate(majority_white_deaths = ifelse(percent_white >= 0.5, 1, 0))
```

```{r}
ggplot(data = county_data, aes(x = majority_white_deaths, y = prop_n_deaths)) + geom_boxplot(aes(group = majority_white_deaths))
```
 
This graph shows the deaths per 1000 people for counties in which greater than or equal to 50% of the people killed were white, compared to counties in which greater than 50% of the people killed were not.

- find confidence interval for difference in means


```{r}
ggplot(county_data, aes(x = avg_pov, y = prop_n_deaths))+
         geom_point()+
         geom_smooth()
```

```{r}
ggplot(county_data, aes(x =  avg_urate, y = prop_n_deaths))+
         geom_point()+
         geom_smooth()
```

```{r}
#ggplot(county_data, aes(x =  avg_college, y = prop_n_deaths))+
       geom_point(position = "identity")
```

